# This is the GlobalStat Entity
# it is supposed to keep track of anything we might need
# to access counters / stats with a single query...
type GlobalStat @entity {
  # the id must be unique, and always the same, so we are sure
  # we always update the same entity on our database.
  # that's why we're using a const as ID = "unique_stats_id"
  id: ID!,
  # TODO: this should be improved by adding a one-to-many as we did for holdersCounter...
  locksCounter: BigInt
  # this is a one-to-many relationship, to keep track of the amount of holders
  # for each token we'll be indexing...
  holdersCounter: [HoldersCounter!] @derivedFrom(field: "globalStat")
}

type HoldersCounter @entity {
  # the id here is the token's name (i.e: DOUGH, YPIE, etc)
  id: ID!
  # the counter, to keep track of the total amount of holders for each token
  count: BigInt!
  # the one-to-many reference to the parent entity
  globalStat: GlobalStat!
}

type Holder @entity {
  # the id here is the eth address of the holder, in hex format
  id: ID!
  # the one-to-many relationship, to keep track of all the tokens 
  # each holder is having, and it's total balance
  tokens: [Token!]! @derivedFrom(field: "holder")
}

type Token @entity {
  # the id here is a componed string, combining the holder's address 
  # and the token's name as follows:
  # holder_address + "_" + token_name
  id: ID!
  # the total amount of token owned by a specific address
  balance: BigInt!
  # the symbol of the token
  symbol: String!
  # the one-to-many reference to the parent entity
  holder: Holder!
}